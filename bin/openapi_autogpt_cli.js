#!/usr/bin/env node

// npm imports
import * as Commander from "commander"

// local imports
import cliCommandQuery from "../src/cli_commands/cli_command_query.js"

///////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////
//	
///////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////

// make sure console.assert produce an exception in node.js
// - this is not the default on node.js... on node.js it just display a message
// - for more info, see https://nodejs.org/dist/latest-v14.x/docs/api/console.html#console_console_assert_value_message
import Assert from 'assert'
console.assert = function (condition, message) { Assert.ok(condition, message) }

// set default dns lookup order to ipv4 first - https://nodejs.org/api/dns.html#dnssetdefaultresultorderorder
import Dns from 'dns'
Dns.setDefaultResultOrder('ipv4first')

///////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////
//	main async function
///////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////

async function mainAsync() {
	/////////////////////////////////////////////////////////////////////////////////////
	/////////////////////////////////////////////////////////////////////////////////////
	//	Parse command line
	/////////////////////////////////////////////////////////////////////////////////////
	/////////////////////////////////////////////////////////////////////////////////////

	// parse command line
	const cmdline = new Commander.Command()

	cmdline.name('openapi-autogpt')
		.version('0.0.3')
		.description('openapi-autogpt - text chat bot able to talk to any openapi server');

	cmdline.command('query')
		.description('query a bot')
		.requiredOption('-o, --openapi <openapiPath>', 'the path for the openapi.json file')
		.requiredOption('-a, --autogpt <autogptPath>', 'the path for the autogpt.json file')
		.action(async (options) => {
			await cliCommandQuery(options.openapi, options.autogpt)
		})

	// parse command line
	cmdline.parse(process.argv)
}

///////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////
//	call main async function (without async prefix because of top level await)
///////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////

void mainAsync()
